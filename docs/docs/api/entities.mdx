---
title: Entities & Custom Fields
description: REST endpoints for custom entity metadata, field definitions, and record management.
---

Entity extensibility is central to Open Mercato. These endpoints let you inspect generated entities, author tenant- or org-scoped overrides, and manage the data itself.

```bash
export BASE_URL="http://localhost:3000/api"
export AUTH_TOKEN="<jwt from POST /login>"
export ENTITY_ID="example.todo"        # generated or custom entity id
export CUSTOM_ENTITY_ID="<custom entity uuid>"  # returned by POST /entities
export RECORD_ID="<record uuid>"
```

## Entity Catalog — `GET /entities`

**Feature:** Authenticated user (scoped by tenant/org)

```bash
curl -X GET "$BASE_URL/entities" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Accept: application/json"
```

Response snippet:

```json
{
  "items": [
    {
      "entityId": "example.todo",
      "source": "code",
      "label": "example.todo",
      "count": 4
    },
    {
      "entityId": "custom.ticket",
      "source": "custom",
      "label": "Support Ticket",
      "description": "Tenant-defined issue tracker",
      "showInSidebar": true,
      "count": 6
    }
  ]
}
```

## Upsert Custom Entity — `POST /entities`

**Feature:** `entities.definitions.manage`

```bash
curl -X POST "$BASE_URL/entities" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "entityId": "custom.ticket",
    "label": "Support Ticket",
    "description": "Tenant-defined issue tracker",
    "isActive": true,
    "labelField": "title",
    "defaultEditor": "markdown",
    "showInSidebar": true
  }'
```

Response:

```json
{
  "ok": true,
  "item": {
    "id": "5b10b44a-97a6-4f42-9b86-11df3cf9f54d",
    "entityId": "custom.ticket",
    "label": "Support Ticket",
    "description": "Tenant-defined issue tracker"
  }
}
```

## Soft Delete Custom Entity — `DELETE /entities`

**Feature:** `entities.definitions.manage`

```bash
curl -X DELETE "$BASE_URL/entities" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "entityId": "custom.ticket"
  }'
```

Response:

```json
{ "ok": true }
```

## Sidebar Entities — `GET /entities/sidebar-entities`

**Feature:** Authenticated user

```bash
curl -X GET "$BASE_URL/entities/sidebar-entities" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Accept: application/json"
```

Returns the subset flagged with `showInSidebar` for navigation building.

## Field Definitions

### List Active Definitions — `GET /entities/definitions`

**Feature:** Authenticated user  
Requires `entityId` query parameter.

```bash
curl -X GET "$BASE_URL/entities/definitions?entityId=$ENTITY_ID" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Accept: application/json"
```

### Upsert Definition — `POST /entities/definitions`

**Feature:** `entities.definitions.manage`

```bash
curl -X POST "$BASE_URL/entities/definitions" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"entityId\": \"$ENTITY_ID\",
    \"key\": \"priority\",
    \"kind\": \"enum\",
    \"configJson\": {
      \"label\": \"Priority\",
      \"options\": [\"low\", \"medium\", \"high\"],
      \"filterable\": true
    },
    \"isActive\": true
  }"
```

### Delete Definition — `DELETE /entities/definitions`

**Feature:** `entities.definitions.manage`

```bash
curl -X DELETE "$BASE_URL/entities/definitions" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"entityId\": \"$ENTITY_ID\",
    \"key\": \"priority\"
  }"
```

### Management Snapshot — `GET /entities/definitions/manage`

**Feature:** `entities.definitions.manage`  
Returns active + tombstoned entries to help build administration UI.

```bash
curl -X GET "$BASE_URL/entities/definitions/manage?entityId=$ENTITY_ID" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Accept: application/json"
```

### Batch Upsert — `POST /entities/definitions/batch`

**Feature:** `entities.definitions.manage`

```bash
curl -X POST "$BASE_URL/entities/definitions/batch" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"entityId\": \"$ENTITY_ID\",
    \"definitions\": [
      {
        \"key\": \"status\",
        \"kind\": \"enum\",
        \"configJson\": {
          \"label\": \"Status\",
          \"options\": [\"open\", \"in_progress\", \"done\"],
          \"listVisible\": true
        },
        \"isActive\": true
      },
      {
        \"key\": \"assignee\",
        \"kind\": \"string\",
        \"configJson\": {
          \"label\": \"Assignee\",
          \"filterable\": true
        },
        \"isActive\": true
      }
    ]
  }"
```

### Restore Definition — `POST /entities/definitions/restore`

**Feature:** `entities.definitions.manage`

```bash
curl -X POST "$BASE_URL/entities/definitions/restore" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"entityId\": \"$ENTITY_ID\",
    \"key\": \"priority\"
  }"
```

Response:

```json
{ "ok": true }
```

## Relation Options — `GET /entities/relations/options`

**Feature:** `entities.definitions.view`  
Use to power select inputs that reference another entity.

```bash
curl -X GET "$BASE_URL/entities/relations/options?entityId=$ENTITY_ID&labelField=title&q=demo" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Accept: application/json"
```

Response:

```json
{
  "items": [
    { "value": "6d44ce18-4bc7-49d6-8b25-a94288363f25", "label": "Demo Ticket" }
  ]
}
```

## Records

### List Records — `GET /entities/records`

**Feature:** `entities.records.view`  
Requires `entityId`; supports pagination, filtering (including `cf_` custom fields), sorting, CSV/JSON export.

```bash
curl -X GET "$BASE_URL/entities/records?entityId=$ENTITY_ID&page=1&pageSize=25&search=demo" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Accept: application/json"
```

### Create Record — `POST /entities/records`

**Feature:** `entities.records.manage`

```bash
curl -X POST "$BASE_URL/entities/records" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"entityId\": \"$ENTITY_ID\",
    \"fields\": {
      \"title\": \"Onboard new merchant\",
      \"description\": \"Kick off data import and permissions setup\",
      \"cf_priority\": \"high\"
    }
  }"
```

Response:

```json
{ "id": "8a4377f9-3c1b-4f4f-91cc-d1d913db5e11" }
```

### Update Record — `PUT /entities/records`

**Feature:** `entities.records.manage`

```bash
curl -X PUT "$BASE_URL/entities/records" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"entityId\": \"$ENTITY_ID\",
    \"id\": \"$RECORD_ID\",
    \"fields\": {
      \"title\": \"Onboard new merchant (Updated)\",
      \"cf_priority\": \"medium\"
    }
  }"
```

Response:

```json
{ "ok": true }
```

### Delete Record — `DELETE /entities/records?id=<uuid>&entityId=<id>`

**Feature:** `entities.records.manage`  
Performs a soft delete (respects tenant/org scope).

```bash
curl -X DELETE "$BASE_URL/entities/records?id=$RECORD_ID&entityId=$ENTITY_ID" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Accept: application/json"
```

Response:

```json
{ "ok": true }
```

> **Next steps:** Pair these APIs with the Query Engine (`@open-mercato/shared/lib/query/types`) for advanced filtering, or plug them into custom admin forms using the shared `CrudForm` component to deliver tenant-ready experiences.

---
title: API routing overview
description: How the platform discovers and dispatches REST endpoints per module.
---

Open Mercato exposes REST endpoints by discovering files under `src/modules/<module>/api/<method>/<path>.ts` (or their package equivalents). Each file exports a default handler and optional metadata.

## Discovery & routing

- Routes are indexed by `method + path` during `npm run modules:prepare` and stored in `modules.generated.ts`.
- The global dispatcher lives in `src/app/api/[...slug]/route.ts`. It normalises the request path, looks up the handler, and instantiates a request container.
- Metadata controls authentication and authorisation:
  - `requireAuth: boolean`
  - `requireFeatures: string[]`
  - `requireRoles: string[]`

## Handler signature

```ts
import type { ApiHandler } from '@open-mercato/shared/modules/api/types';

const handler: ApiHandler = async ({ request, container, organization, user }) => {
  const result = await container.resolve('inventoryService').list({ organizationId: organization.id });
  return Response.json({ items: result });
};

export const metadata = {
  requireAuth: true,
  requireFeatures: ['inventory_items.view'],
};

export default handler;
```

## Responses & errors

- Use `Response.json()` or helpers from `@open-mercato/shared/modules/api/responses` for consistent status codes.
- Throw `HttpError` from `@open-mercato/shared/modules/errors` to send typed errors.
- Log contextual information via the request logger: `container.resolve('logger').info({ ... }, 'message')`.

## Testing

- Import the handler and execute it with a mock container using Awilixâ€™s `createContainer` in your Jest tests.
- Use the [API data fetching tutorial](../../tutorials/api-data-fetching) for an end-to-end walkthrough.

Most CRUD operations can rely on the [CRUD factory](./crud-factory), but understanding the routing layer ensures you can always drop down to custom implementations when necessary.
